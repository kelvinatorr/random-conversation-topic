<!DOCTYPE html>
<html>
<head>
    <link href="../bower_components/polymer/polymer.html" rel="import">
    <!-- Element Imports -->
    <!--<link rel="import" href="../styles/app-theme.html">-->
    <link rel="import" href="../bower_components/iron-icons/iron-icons.html">
    <link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
    <link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
    <link rel="import" href="../bower_components/paper-button/paper-button.html">
    <link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
    <link rel="import" href="../bower_components/polymerfire/firebase-app.html">
    <link rel="import" href="../bower_components/polymerfire/firebase-document.html">
</head>

<dom-module id="rct-app">
    <style is="custom-style" include="iron-flex iron-flex-alignment"></style>
    <style is="custom-style">
        /* CSS rules for your element */
        .rct-button-container {
            margin: 13px;
        }

        .rct-button-container> paper-button{
            width: 100%;
        }

        paper-button.indigo {
            background-color: var(--paper-indigo-500);
            color: white;
        }

        paper-button.indigo[disabled] {
            background: #eaeaea;
            color: #a8a8a8
        }

        /*paper-button:focus {*/
            /*background-color: default;*/
            /*color: default;*/
            /*font-weight: normal;;*/
        /*}*/

        paper-button {
            --paper-button-raised-keyboard-focus: {
                background-color: default;
                color: default;
                font-weight: normal;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);;
            }
        }

        p {
            font-family: 'Roboto', 'Noto', 'sans-serif';
        }
    </style>
    <template>
        <!-- local DOM for your element -->
        <paper-toolbar>
            <span class="title">Random Conversation Topic</span>
        </paper-toolbar>

        <div class="layout vertical">
            <div class="layout horizontal center center-center" id="topicWrapperDiv">
                <p id="rctTopic" hidden>{{visibleTopic}}</p>
            </div>
            <div class="rct-button-container layout horizontal">
                <paper-button class="indigo" raised id="pickATopicBtn" on-tap="pickATopic" disabled>Pick A Topic</paper-button>
            </div>

            <div class="rct-button-container layout horizontal">
                <paper-button raised id="shareBtn" on-tap="share" disabled>Share</paper-button>
            </div>

        </div>
        <firebase-app auth-domain="random-conversation-topic.firebaseapp.com"
                      database-url="https://random-conversation-topic.firebaseio.com"
                      api-key="AIzaSyClduzlz0MPdn4e6jVnMX6M2iAwa8e96MA">
        </firebase-app>
        <firebase-document
                path="/topics"
                data="{{topics}}">
        </firebase-document>
        <firebase-document
                path="/topics/{{currentIndex}}"
                data="{{visibleTopic}}">
        </firebase-document>
    </template>
    <script>
        Polymer({
            is: "rct-app",
            properties: {
                topics: {
                    type: Array,
                    observer: 'dataChanged'
                },
                visibleTopic: {
                    type: String
                },
                currentIndex: {
                    type: Number
                },
                pickIndex: {
                    type: Number
                }
            },
            ready: function (e) {
            },

            pickATopic: function() {
                console.log('picking a topic!');
                // disable the pick button
                var pickTopicBtn = document.getElementById('pickATopicBtn');
                pickTopicBtn.disabled = true;
                // select a random number from the length of the topics array
                this.pickIndex = Math.floor(Math.random() * this.topics.length);
                document.getElementById('rctTopic').hidden = false;
                // TODO: run slot machine look
                // show the pick
                this.currentIndex = this.pickIndex;
                pickTopicBtn.disabled = false;

            },

            share: function() {
                console.log('generating share token');
            },

            dataChanged: function() {
                if(this.topics.length === 2) {
                    document.getElementById('pickATopicBtn').disabled = false;
                    document.getElementById('shareBtn').disabled = false;
                }
            },

            _runSlotMachineLook: function() {

            }

        });
    </script>
</dom-module>
